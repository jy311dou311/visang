<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>가치찾기</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 60px 0; background:#fff; }
    .screen { display: none; }
    .screen.active { display: block; }

    input, select { padding: 10px; margin: 6px; width: 260px; max-width: 90vw; }
    button { padding: 10px 18px; margin-top: 12px; cursor: pointer; }

    .card{
      width: min(980px, 95vw);
      margin: 0 auto;
      border: 1px solid #ddd;
      border-radius: 16px;
      padding: 14px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.06);
      background: #fff;
      text-align: left;
    }
    .title{
      display:flex; justify-content: space-between; align-items: baseline;
      gap: 10px; margin-bottom: 10px;
    }
    .badge{
      font-size: 12px; padding: 4px 10px; border-radius: 999px;
      border: 1px solid #ddd; background: #f7f7f7; white-space: nowrap;
    }
    .hint { font-size: 13px; color: #666; margin-top: 6px; }

    .map-stage{
      position: relative;
      width: 100%;
      border-radius: 14px;
      overflow: hidden;
      border: 1px solid #eee;
      background: #fafafa;
    }
    .map-stage img{
      display: block;
      width: 100%;
      height: auto;
      user-select: none;
      -webkit-user-drag: none;
    }
    .map-stage svg{
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
    }

    .region{
     fill: rgba(0,0,0,0);
     cursor: pointer;
     transition: fill 160ms ease, stroke 160ms ease, filter 160ms ease;
    }

/* ✅ 마우스 올렸을 때 클릭 범위 강조 */
    .region:hover{
     fill: rgba(0, 123, 255, 0.25);     /* 파란 반투명 */
     stroke: rgba(0, 123, 255, 0.9);   /* 테두리 선명 */
     stroke-width: 3;
     filter: drop-shadow(0 0 6px rgba(0,123,255,0.45));
    }


    .btn-row{
      display:flex; justify-content:center; gap: 10px;
      flex-wrap: wrap; margin-top: 12px;
    }

    .viewer {
      display: grid;
      gap: 12px;
      place-items: center;
      text-align: center;
      padding-top: 6px;
    }

    /* ✅ 이미지 크기 균등(필요 없으면 변경/삭제 가능) */
    .viewer img{
      width: 100%;
      max-width: 420px;
      height: 260px;
      object-fit: cover;
      border-radius: 12px;
      border: 1px solid #eee;
      background: #fafafa;
      transform-origin: center center;
      transition: transform 140ms ease;
    }

    /* ✅ 툴팁(마우스 오버 시 장소명 표시) */
    .tooltip {
      position: fixed;
      z-index: 9999;
      padding: 6px 10px;
      border-radius: 10px;
      background: rgba(0,0,0,0.78);
      color: #fff;
      font-size: 13px;
      line-height: 1.2;
      pointer-events: none;
      opacity: 0;
      transform: translate(-50%, -120%);
      transition: opacity 80ms ease;
      white-space: nowrap;
    }
    .tooltip.show { opacity: 1; }

    .title-right{
      display: flex;
      flex-direction: column;
      align-items: flex-end; /* 오른쪽 정렬 */
      gap: 8px;
    }

    .reset-mini{
      padding: 8px 12px;
      border-radius: 12px;
      border: 1px solid #ddd;
      background: #fff;
      cursor: pointer;
      font-size: 12px;
    }
    .reset-mini:hover{
      background: #f6f6f6;
    }

  </style>
</head>
<body>

  <!-- 1) 입력 화면 -->
  <div id="screen1" class="screen active">
    <h1>정보 입력</h1>

    <input type="text" id="name" placeholder="이름" autocomplete="name" /><br>

    <select id="department">
      <option value="">부서 선택</option>
      <option value="에듀테크콘텐츠1">에듀테크콘텐츠1</option>
      <option value="라키비움">라키비움</option>
      <option value="기출탭탭">기출탭탭</option>
      <option value="국어2">국어2</option>
      <option value="티칭콘텐츠개발3">티칭콘텐츠개발3</option>
    </select><br>

    <button id="nextBtn">다음</button>
  </div>

  <!-- 2) 지도 화면 (7구역) -->
  <div id="screen2" class="screen">
    <div class="card">
      <div class="title">
         <div>
             <h2 style="margin:0">7구역 선택</h2>
             <div class="hint">지도에서 구역을 클릭하면 상세 화면으로 이동해요.</div>
         </div>

         <div class="title-right">
             <div class="badge" id="userBadge"></div>
             <button id="resetBtn" class="reset-mini">저장값 초기화</button>
         </div>
     </div>


      <div class="map-stage">
        <!-- ✅ 원본(첫 사진) 파일명을 floor.png로 저장해서 index.html과 같은 폴더에 두세요 -->
        <img src="floor.png" alt="지도">

        <!-- ✅ 원본 이미지 크기: 1536 x 1024 -->
        <!-- ⚠️ [확정] 아래 7개 구역(rect) x/y/width/height/rx/ry 값은 더 이상 수정하지 않음 -->
        <svg viewBox="0 0 1536 1024" preserveAspectRatio="xMidYMid meet" aria-label="클릭 가능한 7구역">
          <!-- 1) 휴담 -->
          <rect class="region" data-region="휴담"
                x="205" y="115" width="466" height="110" rx="28" ry="28"></rect>

          <!-- 2) 통실 (정정 반영) -->
          <rect class="region" data-region="통실"
                x="671" y="115" width="765" height="287" rx="28" ry="28"></rect>

          <!-- 3) 스마트 클래스 (정정 반영) -->
          <rect class="region" data-region="스마트 클래스"
                x="1365" y="402" width="70" height="253" rx="28" ry="28"></rect>

          <!-- 4) 도서관 -->
          <rect class="region" data-region="도서관"
                x="97" y="225" width="203" height="447" rx="28" ry="28"></rect>

          <!-- 5) 스마트아카이브 -->
          <rect class="region" data-region="스마트아카이브"
                x="97" y="780" width="248" height="88" rx="28" ry="28"></rect>

          <!-- 6) 교과서의 역사 -->
          <rect class="region" data-region="교과서의 역사"
                x="345" y="780" width="841" height="88" rx="28" ry="28"></rect>

          <!-- 7) 에듀테크존 -->
          <rect class="region" data-region="에듀테크존"
                x="315" y="225" width="248" height="70" rx="28" ry="28"></rect>
        </svg>
      </div>

      <div class="btn-row">
        <button id="backBtn">뒤로</button>
      </div>
    </div>
  </div>

  <!-- 3) 구역 상세 화면 -->
  <div id="screen3" class="screen">
    <div class="card">
      <div class="title">
        <div>
          <h2 style="margin:0" id="regionTitle">구역</h2>
          <div class="hint" id="regionSub">공간을 소개합니다.</div>
        </div>
        <div class="badge" id="userBadge3"></div>
      </div>

      <div class="viewer">
        <img id="regionImage" alt="선택된 구역 이미지">
      </div>

      <div class="btn-row">
        <button id="toMapBtn">지도 돌아가기</button>
      </div>
    </div>
  </div>

  <!-- 툴팁 -->
  <div id="tooltip" class="tooltip"></div>

  <script>
    // ===== 저장 키 =====
    const KEY_NAME = "saved_name";
    const KEY_DEPT = "saved_department";
    const KEY_REGION = "saved_region";

    // ===== 화면 =====
    const screen1 = document.getElementById("screen1");
    const screen2 = document.getElementById("screen2");
    const screen3 = document.getElementById("screen3");

    // ===== 입력 =====
    const nameInput = document.getElementById("name");
    const deptSelect = document.getElementById("department");

    // ===== 버튼 =====
    const nextBtn = document.getElementById("nextBtn");
    const backBtn = document.getElementById("backBtn");
    const resetBtn = document.getElementById("resetBtn");
    const toMapBtn = document.getElementById("toMapBtn");

    // ===== 뱃지 =====
    const userBadge = document.getElementById("userBadge");
    const userBadge3 = document.getElementById("userBadge3");

    // ===== 상세 화면 =====
    const regionTitle = document.getElementById("regionTitle");
    const regionSub = document.getElementById("regionSub");
    const regionImage = document.getElementById("regionImage");

    // ===== 구역 요소 =====
    const regionEls = document.querySelectorAll(".region");

    // ✅ 구역별로 보여줄 이미지 파일 매핑 (파일명은 원하는대로 바꿔도 됨)
    const regionToImage = {
      "휴담": "hudam.png",
      "통실": "tongsil.png",
      "스마트 클래스": "smart-class.png",
      "도서관": "library.png",
      "스마트아카이브": "archive.png",
      "교과서의 역사": "history.png",
      "에듀테크존": "edutech.png",
    };

    // ✅ 구역별로 표시할 문구(원하면 여기만 수정)
    const regionToText = {
      "휴담": "휴담 공간에 대한 뭔가 TMI가 있으면 쓰는 느낌.?",
      "통실": "VL층의 통실 이름은 비상의 가치와 발자취가 담겨 있습니다.",
      "스마트 클래스": "이것도 뭔가 기깔난 TMI없을까요.?",
      "도서관": "여러 종류의 책을 빌릴 수 있어요!",
      "스마트아카이브": "스마트아카이브 공간을 소개합니다.",
      "교과서의 역사": "교과서의 역사 공간을 소개합니다.",
      "에듀테크존": "에듀테크존 공간을 소개합니다.",
    };

    // (선택) 구역별 이미지 회전값 (이미지가 돌아가 있으면 여기만 수정)
    const regionRotation = {
      "휴담": 0,
      "통실": 0,
      "스마트 클래스": 0,
      "도서관": 0,
      "스마트아카이브": 0,
      "교과서의 역사": 0,
      "에듀테크존": 0,
    };

    // ====== 라우팅(뒤로가기 지원) ======
    function renderScreen(n) {
      screen1.classList.toggle("active", n === 1);
      screen2.classList.toggle("active", n === 2);
      screen3.classList.toggle("active", n === 3);
    }

    function go(screenNum, replace = false) {
      const state = { screen: screenNum };
      const url = `#s${screenNum}`; // #s1 / #s2 / #s3

      if (replace) history.replaceState(state, "", url);
      else history.pushState(state, "", url);

      renderScreen(screenNum);
    }

    function screenFromHash() {
      const h = (location.hash || "").toLowerCase();
      if (h === "#s2") return 2;
      if (h === "#s3") return 3;
      return 1;
    }

    window.addEventListener("popstate", () => {
      renderScreen(screenFromHash());
    });

    // ====== 기본 기능 ======
    function saveInputs(name, dept) {
      localStorage.setItem(KEY_NAME, name);
      localStorage.setItem(KEY_DEPT, dept);
    }

    function loadInputs() {
      const savedName = localStorage.getItem(KEY_NAME) || "";
      const savedDept = localStorage.getItem(KEY_DEPT) || "";
      if (savedName) nameInput.value = savedName;
      if (savedDept) deptSelect.value = savedDept;
    }

    function updateBadges() {
      const n = (localStorage.getItem(KEY_NAME) || "").trim();
      const d = localStorage.getItem(KEY_DEPT) || "";
      const text = (n && d) ? `${n} · ${d}` : "";
      userBadge.textContent = text;
      userBadge3.textContent = text;
    }

    function nextScreen() {
      const name = nameInput.value.trim();
      const dept = deptSelect.value;

      if (!name || !dept) {
        alert("이름과 부서를 모두 입력/선택해주세요!");
        return;
      }

      saveInputs(name, dept);
      updateBadges();
      go(2);
    }

    nameInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") nextScreen();
    });
    deptSelect.addEventListener("keydown", (e) => {
      if (e.key === "Enter") nextScreen();
    });

    function openRegion(regionName) {
      localStorage.setItem(KEY_REGION, regionName);

      const imgSrc = regionToImage[regionName];
      regionTitle.textContent = regionName;
      regionSub.textContent = regionToText[regionName] || `${regionName} 공간을 소개합니다.`;

      if (imgSrc) {
        regionImage.src = imgSrc;
        regionImage.alt = `${regionName} 이미지`;
        const deg = regionRotation[regionName] ?? 0;
        regionImage.style.transform = `rotate(${deg}deg)`;
      } else {
        regionImage.removeAttribute("src");
        regionImage.alt = "이미지가 없습니다.";
        regionImage.style.transform = "rotate(0deg)";
      }

      updateBadges();
      go(3);
    }

    function resetAll() {
      localStorage.removeItem(KEY_NAME);
      localStorage.removeItem(KEY_DEPT);
      localStorage.removeItem(KEY_REGION);
      nameInput.value = "";
      deptSelect.value = "";
      alert("저장된 값이 초기화됐어요!");
      go(1, true); // 히스토리 쌓지 않게
    }

    nextBtn.addEventListener("click", nextScreen);
    backBtn.addEventListener("click", () => go(1));
    toMapBtn.addEventListener("click", () => go(2));
    resetBtn.addEventListener("click", resetAll);

    regionEls.forEach(el => {
      el.addEventListener("click", () => openRegion(el.dataset.region));
    });

    // ====== 툴팁(장소명) ======
    const tooltip = document.getElementById("tooltip");
    function showTooltip(text, clientX, clientY) {
      tooltip.textContent = text;
      tooltip.style.left = `${clientX}px`;
      tooltip.style.top = `${clientY}px`;
      tooltip.classList.add("show");
    }
    function moveTooltip(clientX, clientY) {
      tooltip.style.left = `${clientX}px`;
      tooltip.style.top = `${clientY}px`;
    }
    function hideTooltip() {
      tooltip.classList.remove("show");
    }

    regionEls.forEach(el => {
      const name = el.dataset.region;

      el.addEventListener("mouseenter", (e) => showTooltip(name, e.clientX, e.clientY));
      el.addEventListener("mousemove", (e) => moveTooltip(e.clientX, e.clientY));
      el.addEventListener("mouseleave", hideTooltip);

      el.addEventListener("touchstart", (e) => {
        const t = e.touches[0];
        showTooltip(name, t.clientX, t.clientY);
        setTimeout(hideTooltip, 900);
      }, { passive: true });
    });

    window.addEventListener("scroll", hideTooltip, { passive: true });
    window.addEventListener("resize", hideTooltip);

    // ====== 초기 로딩 ======
    loadInputs();
    updateBadges();

    // 새로고침/직접 URL로 들어와도 화면 복원
    // 입력값이 없는데 #s2/#s3로 들어오면 #s1로 보정
    (function initRoute() {
      const hasUser = (localStorage.getItem(KEY_NAME) || "").trim() && (localStorage.getItem(KEY_DEPT) || "");
      const target = screenFromHash();

      if (!hasUser && target !== 1) {
        go(1, true);
        return;
      }

      // #s3로 들어왔는데, 선택 구역이 없으면 #s2로 보정
      if (target === 3) {
        const savedRegion = localStorage.getItem(KEY_REGION);
        if (!savedRegion) {
          go(2, true);
          return;
        }
        // savedRegion이 있으면 화면3 내용도 복원
        openRegion(savedRegion);
        // openRegion이 go(3)을 pushState 하므로, 초기에는 replace로 맞추기
        history.replaceState({ screen: 3 }, "", "#s3");
        return;
      }

      go(target, true);
    })();
  </script>
</body>
</html>
